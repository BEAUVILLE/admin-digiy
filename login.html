<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login Admin DIGIY</title>
  <meta name="theme-color" content="#0a0e1a" />

  <style>
    :root{ --bg:#0a0e1a; --accent:#facc15; --text:#e5e7eb; --muted:#9ca3af; --card:rgba(26,31,46,0.95);}
    *{box-sizing:border-box;margin:0;padding:0}
    body{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#0a0e1a,#1a1f2e);color:var(--text);font-family:system-ui,sans-serif;padding:20px}
    .login-card{background:var(--card);backdrop-filter:blur(10px);padding:38px 28px;border-radius:20px;border:1px solid rgba(148,163,184,.2);max-width:420px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,.5)}
    .logo{width:78px;height:78px;background:linear-gradient(135deg,#facc15,#eab308);border-radius:20px;display:flex;align-items:center;justify-content:center;font-size:38px;margin:0 auto 20px;box-shadow:0 0 30px rgba(250,204,21,.4)}
    h1{text-align:center;font-size:28px;font-weight:950;margin-bottom:6px}
    .subtitle{text-align:center;color:var(--muted);font-size:13px;margin-bottom:18px}
    label{display:block;font-size:12px;font-weight:800;color:var(--muted);margin:14px 0 8px;text-transform:uppercase;letter-spacing:.06em}
    input{width:100%;padding:15px 14px;border-radius:12px;border:1px solid rgba(148,163,184,.3);background:rgba(15,23,42,.8);color:var(--text);font-size:15px;font-weight:800;outline:none}
    input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(250,204,21,.2);background:rgba(15,23,42,.95)}
    .btn{width:100%;padding:16px;border:none;border-radius:12px;background:linear-gradient(135deg,#facc15,#eab308);color:#0a0e1a;font-size:15px;font-weight:950;cursor:pointer;text-transform:uppercase;letter-spacing:.08em;margin-top:16px}
    .btn:disabled{opacity:.65;cursor:not-allowed}
    .msg{padding:12px;border-radius:10px;font-size:13px;font-weight:800;margin:12px 0 0;display:none;line-height:1.35}
    .msg.show{display:block}
    .msg.err{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:#ef4444}
    .msg.ok{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);color:#22c55e}
    .row{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
    .link{background:transparent;border:0;color:#cbd5e1;font-weight:800;cursor:pointer;text-decoration:underline}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ‚úÖ Un seul client partout (m√™me storageKey)
    window.sb = window.sb || window.supabase.createClient(
      "https://wesqmwjjtsefyjnluosj.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA",
      { auth:{ persistSession:true, autoRefreshToken:true, detectSessionInUrl:true, storageKey:"digiy-admin-auth" } }
    );
  </script>
</head>

<body>
  <div class="login-card">
    <div class="logo">ü¶Ö</div>
    <h1>DIGIY Admin</h1>
    <div class="subtitle">Connexion s√©curis√©e</div>

    <div class="msg err" id="err">‚Äî</div>
    <div class="msg ok" id="ok">‚Äî</div>

    <form id="f">
      <label>Email</label>
      <input id="email" type="email" autocomplete="email" placeholder="baptistejb24@gmail.com" required>

      <label>Mot de passe</label>
      <input id="pass" type="password" autocomplete="current-password" required>

      <button class="btn" id="btn" type="submit">üîì Se connecter</button>

      <div class="row">
        <button class="link" id="resetBtn" type="button">Mot de passe oubli√©</button>
      </div>
    </form>
  </div>

<script>
  const $ = (id)=>document.getElementById(id);
  const f=$("f"), btn=$("btn"), err=$("err"), ok=$("ok");
  const email=$("email"), pass=$("pass");

  function show(el, text){ el.textContent=text||"‚Äî"; el.classList.add("show"); }
  function hide(el){ el.classList.remove("show"); }

  // d√©j√† connect√© ? -> index
  sb.auth.getSession().then(({data})=>{
    if (data.session) location.replace("index.html");
  });

  f.addEventListener("submit", async (e)=>{
    e.preventDefault();
    hide(err); hide(ok);

    btn.disabled=true; btn.textContent="‚è≥ Connexion‚Ä¶";
    show(ok,"‚è≥ Connexion‚Ä¶");

    try{
      const { data, error } = await sb.auth.signInWithPassword({
        email: (email.value||"").trim(),
        password: pass.value||""
      });
      if (error) throw error;

      const sess = await sb.auth.getSession();
      if(!sess.data.session) throw new Error("Session non persist√©e");

      show(ok,"‚úÖ OK. Redirection‚Ä¶");
      setTimeout(()=>location.replace("index.html"), 300);

    }catch(ex){
      console.error(ex);
      hide(ok);
      show(err, "‚ö†Ô∏è " + String(ex?.message||ex));
      btn.disabled=false; btn.textContent="üîì Se connecter";
    }
  });

  $("resetBtn").addEventListener("click", async ()=>{
  hide(err); hide(ok);
  const em = (email.value||"").trim();
  if(!em) return show(err,"Entre ton email d‚Äôabord.");

  const { data, error } = await sb.auth.resetPasswordForEmail(em, {
    redirectTo: "https://backoffice.digiylyfe.com/reset.html"
  });

  console.log("reset result:", { data, error });
  if (error) return show(err, "‚ùå " + error.message);

  show(ok,"üì© Email de reset demand√©. V√©rifie ta bo√Æte + spam.");
});


    try{
      await sb.auth.resetPasswordForEmail(em, {
        redirectTo: "https://backoffice.digiylyfe.com/reset.html"
      });
      show(ok,"üì© Email de reset envoy√©. Regarde ta bo√Æte.");
    }catch(ex){
      show(err,"‚ö†Ô∏è "+String(ex?.message||ex));
    }
  });
</script>
</body>
</html>
